<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>OCR FastAPI Client</title>
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <div class="container">
    <h2>OCR Client – FastAPI + pytesseract</h2>

    <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.tiff,.tif,.gif,.bmp,.pdf" style="display:none;" />

    <div id="dropArea" class="drop-area">
      Trascina qui il file oppure clicca per selezionarlo
    </div>

    <button id="extractBtn">Estrai Testo</button>

    <div class="progress-bar" id="progressBar">
      <div class="progress-bar-inner" id="progressInner"></div>
    </div>

    <p id="statusMessage" style="font-style: italic; margin-top: 1rem; color: #444;"></p>

    <div class="preview-label" id="previewLabel" style="display:none;">Anteprima immagine:</div>
    <img id="previewImage" style="display:none;" alt="Anteprima immagine caricata" />

    <textarea id="output" placeholder="Il testo OCR verrà mostrato qui..." readonly></textarea>

    <button id="modalOpenBtn">Apri trascrizione in modale</button>

    <!-- Modal -->
    <div id="textModal" class="modal">
      <div class="modal-content" id="modalWindow">
        <span class="close" id="modalCloseBtn">&times;</span>
        <h3>Testo OCR</h3>
        <pre id="modalText"></pre>
      </div>
    </div>

  </div>
  <script type="module" src="static/js/main.js"></script>

<!--  <script>-->
<!--    const dropArea = document.getElementById("dropArea");-->
<!--    const fileInput = document.getElementById("fileInput");-->
<!--    const progressBar = document.getElementById("progressBar");-->
<!--    const progressInner = document.getElementById("progressInner");-->
<!--    let selectedFile = null;-->

<!--    dropArea.addEventListener("click", () => fileInput.click());-->

<!--    dropArea.addEventListener("dragover", (e) => {-->
<!--      e.preventDefault();-->
<!--      dropArea.classList.add("hover");-->
<!--    });-->

<!--    dropArea.addEventListener("dragleave", () => {-->
<!--      dropArea.classList.remove("hover");-->
<!--    });-->

<!--    dropArea.addEventListener("drop", (e) => {-->
<!--      e.preventDefault();-->
<!--      dropArea.classList.remove("hover");-->
<!--      const file = e.dataTransfer.files[0];-->
<!--      if (file) {-->
<!--        selectedFile = file;-->
<!--        dropArea.textContent = `File selezionato: ${file.name}`;-->
<!--      }-->
<!--    });-->

<!--    fileInput.addEventListener("change", () => {-->
<!--      if (fileInput.files.length > 0) {-->
<!--        selectedFile = fileInput.files[0];-->
<!--        dropArea.textContent = `File selezionato: ${selectedFile.name}`;-->
<!--      }-->
<!--    });-->

<!--    function showProgress(percent) {-->
<!--      progressBar.style.display = "block";-->
<!--      progressInner.style.width = percent + "%";-->
<!--    }-->

<!--    function hideProgress() {-->
<!--      progressBar.style.display = "none";-->
<!--      progressInner.style.width = "0%";-->
<!--    }-->

<!--    function setCursorBusy(isBusy) {-->
<!--      document.body.style.cursor = isBusy ? "progress" : "default";-->
<!--    }-->

<!--    function setStatusMessage(message) {-->
<!--      document.getElementById("statusMessage").textContent = message || "";-->
<!--    }-->

<!--    async function uploadFile() {-->
<!--      const output = document.getElementById("output");-->
<!--      const previewImage = document.getElementById("previewImage");-->
<!--      const previewLabel = document.getElementById("previewLabel");-->

<!--      // Disabilita il bottone all’inizio-->
<!--      extractBtn.disabled = true;-->

<!--      if (!selectedFile) {-->
<!--        alert("Seleziona o trascina un file prima di inviare.");-->
<!--        return;-->
<!--      }-->

<!--      setCursorBusy(true);-->
<!--      setStatusMessage("Uploading...");-->

<!--      output.value = "Estrazione in corso...";-->
<!--      previewImage.style.display = "none";-->
<!--      previewLabel.style.display = "none";-->

<!--      showProgress(10);-->

<!--      const formData = new FormData();-->
<!--      formData.append("file", selectedFile);-->

<!--      try {-->
<!--        // Usa XMLHttpRequest per avere eventi di progresso-->
<!--        const xhr = new XMLHttpRequest();-->

<!--        xhr.open("POST", "http://127.0.0.1:8000/extract-text/", true);-->

<!--        xhr.upload.onprogress = (e) => {-->
<!--          if (e.lengthComputable) {-->
<!--            const percent = Math.round((e.loaded / e.total) * 100);-->
<!--            showProgress(percent / 2); // Prima metà per upload-->
<!--          }-->
<!--        };-->

<!--        xhr.onreadystatechange = () => {-->
<!--          setStatusMessage("Processing...");-->
<!--          if (xhr.readyState === 4) {-->
<!--            hideProgress();-->
<!--            extractBtn.disabled = false;  // Riabilita-->
<!--            setCursorBusy(false);-->
<!--            setStatusMessage("");-->
<!--            if (xhr.status === 200) {-->
<!--              const data = JSON.parse(xhr.responseText);-->
<!--              output.value = data.text;-->
<!--              setStatusMessage("Done!");-->

<!--              if (data.preview_image) {-->
<!--                previewImage.src = "data:image/png;base64," + data.preview_image;-->
<!--              } else if (selectedFile.type.startsWith("image/")) {-->
<!--                const imageUrl = URL.createObjectURL(selectedFile);-->
<!--                previewImage.src = imageUrl;-->
<!--              }-->

<!--              if (previewImage.src) {-->
<!--                previewImage.style.display = "block";-->
<!--                previewLabel.style.display = "block";-->
<!--              }-->

<!--            } else {-->
<!--              const error = JSON.parse(xhr.responseText);-->
<!--              setStatusMessage("Errore");-->
<!--              output.value = "Errore: " + (error.detail || "Errore generico.");-->
<!--            }-->
<!--          }-->
<!--        };-->

<!--        xhr.send(formData);-->
<!--        showProgress(75); // Simula elaborazione post-upload-->

<!--      } catch (err) {-->
<!--        hideProgress();-->
<!--        setCursorBusy(false);-->
<!--        extractBtn.disabled = false;  // Riabilita-->
<!--        setStatusMessage("Errore!");-->
<!--        output.value = "Errore: " + err.message;-->
<!--      }-->
<!--    }-->

<!--    function openModal(text) {-->
<!--      document.getElementById("modalText").textContent = text;-->
<!--      document.getElementById("textModal").style.display = "block";-->
<!--    }-->

<!--    function closeModal() {-->
<!--      document.getElementById("textModal").style.display = "none";-->
<!--    }-->
<!--  </script>-->
</body>
</html>
